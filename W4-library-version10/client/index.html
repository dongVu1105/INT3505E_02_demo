<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Management System - REST API Client</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <h1 class="logo">
                üìö Library Management System
                <span class="badge">REST Client-Server + Cacheable</span>
            </h1>
            <nav class="nav" id="mainNav" style="display: none;">
                <button class="nav-btn active" data-view="dashboard">Dashboard</button>
                <button class="nav-btn" data-view="books">Books</button>
                <button class="nav-btn" data-view="borrow-records">Borrow Records</button>
                <button class="btn-cache-info" id="cacheInfoBtn" title="View Cache Status">
                    üíæ <span id="cacheCount">0</span>
                </button>
                <button class="btn-logout" id="logoutBtn">Logout</button>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Alert Container -->
            <div id="alertContainer"></div>

            <!-- Login View -->
            <div id="loginView" class="view active">
                <div class="login-container">
                    <div class="info-box">
                        <h2>üéØ REST API Client-Server Architecture</h2>
                        <p>·ª®ng d·ª•ng n√†y minh h·ªça ki·∫øn tr√∫c <strong>Client-Server</strong> theo nguy√™n t·∫Øc REST:</p>
                        <ul>
                            <li>‚úÖ <strong>Stateless</strong>: Server kh√¥ng l∆∞u session, s·ª≠ d·ª•ng JWT token</li>
                            <li>‚úÖ <strong>Client-Server</strong>: T√°ch bi·ªát ho√†n to√†n UI v√† API</li>
                            <li>‚úÖ <strong>Uniform Interface</strong>: HTTP methods chu·∫©n (GET, POST, PUT, DELETE)</li>
                            <li>‚úÖ <strong>Resource-based</strong>: URL ƒë·ªãnh danh resources</li>
                            <li>‚úÖ <strong>JSON representation</strong>: D·ªØ li·ªáu trao ƒë·ªïi qua JSON</li>
                            <li>‚úÖ <strong>Cacheable</strong>: S·ª≠ d·ª•ng Cache-Control, ETag, conditional requests</li>
                        </ul>
                        <div style="margin-top: 15px; padding: 10px; background: #e3f2fd; border-radius: 5px;">
                            <strong>üíæ Cacheable Principle:</strong>
                            <ul style="margin: 5px 0 0 20px;">
                                <li>Server g·ª≠i Cache-Control headers</li>
                                <li>Client cache responses v√† s·ª≠ d·ª•ng ETag</li>
                                <li>Conditional requests (If-None-Match)</li>
                                <li>304 Not Modified responses</li>
                            </ul>
                        </div>
                    </div>

                    <div class="login-box">
                        <h2>üîê Login</h2>
                        <p class="text-muted">Demo: Nh·∫≠p b·∫•t k·ª≥ username/password n√†o</p>
                        
                        <form id="loginForm">
                            <div class="form-group">
                                <label>Username:</label>
                                <input type="text" id="username" value="admin" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Password:</label>
                                <input type="password" id="password" value="password123" required>
                            </div>
                            
                            <button type="submit" class="btn btn-primary btn-block">
                                Login & Get JWT Token
                            </button>
                        </form>

                        <div id="tokenDisplay" class="token-display" style="display: none;">
                            <strong>JWT Token:</strong>
                            <div id="tokenValue" class="token-value"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard View -->
            <div id="dashboardView" class="view">
                <h2>üìä Dashboard</h2>
                
                <div class="stats-grid" id="statsGrid">
                    <!-- Stats will be loaded here -->
                </div>

                <div class="quick-actions">
                    <h3>Quick Actions</h3>
                    <button class="btn btn-primary" onclick="switchView('books')">
                        üìö Manage Books
                    </button>
                    <button class="btn btn-secondary" onclick="switchView('borrow-records')">
                        üìñ View Borrow Records
                    </button>
                </div>
            </div>

            <!-- Books View -->
            <div id="booksView" class="view">
                <div class="view-header">
                    <h2>üìö Books Management</h2>
                    <button class="btn btn-primary" onclick="showAddBookForm()">
                        + Add New Book
                    </button>
                </div>

                <!-- Add/Edit Book Form -->
                <div id="bookFormContainer" class="form-container" style="display: none;">
                    <h3 id="bookFormTitle">Add New Book</h3>
                    <form id="bookForm">
                        <input type="hidden" id="bookId">
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Title: *</label>
                                <input type="text" id="bookTitle" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Author: *</label>
                                <input type="text" id="bookAuthor" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>ISBN: *</label>
                                <input type="text" id="bookIsbn" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Quantity: *</label>
                                <input type="number" id="bookQuantity" min="1" required>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Save Book</button>
                            <button type="button" class="btn btn-secondary" onclick="hideBookForm()">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Search and Filter Bar -->
                <div class="filter-bar">
                    <div class="filter-group">
                        <input type="text" id="searchTitle" placeholder="üîç Search by title..." 
                               onkeyup="debounceSearch('books')">
                        <input type="text" id="searchAuthor" placeholder="üë§ Search by author..." 
                               onkeyup="debounceSearch('books')">
                        <input type="text" id="searchISBN" placeholder="üìñ Search by ISBN..." 
                               onkeyup="debounceSearch('books')">
                    </div>
                    <div class="filter-group">
                        <label>
                            <input type="checkbox" id="availableOnlyFilter" onchange="loadBooks(1)">
                            Available only
                        </label>
                        <select id="sortByBooks" onchange="loadBooks(1)">
                            <option value="created_at">Sort by: Date Created</option>
                            <option value="title">Sort by: Title</option>
                            <option value="author">Sort by: Author</option>
                            <option value="isbn">Sort by: ISBN</option>
                        </select>
                        <select id="sortOrderBooks" onchange="loadBooks(1)">
                            <option value="desc">Descending</option>
                            <option value="asc">Ascending</option>
                        </select>
                        <button class="btn btn-secondary btn-sm" onclick="clearBooksFilters()">
                            Clear Filters
                        </button>
                    </div>
                </div>

                <!-- Results Info -->
                <div id="booksResultInfo" class="result-info"></div>

                <!-- Books List -->
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Title</th>
                                <th>Author</th>
                                <th>ISBN</th>
                                <th>Quantity</th>
                                <th>Available</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="booksTableBody">
                            <!-- Books will be loaded here -->
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div id="booksPagination" class="pagination"></div>
            </div>

            <!-- Borrow Records View -->
            <div id="borrowRecordsView" class="view">
                <div class="view-header">
                    <h2>üìñ Borrow Records</h2>
                    <button class="btn btn-primary" onclick="showBorrowBookForm()">
                        + Borrow Book
                    </button>
                </div>

                <!-- Borrow Book Form -->
                <div id="borrowFormContainer" class="form-container" style="display: none;">
                    <h3>Borrow a Book</h3>
                    <form id="borrowForm">
                        <div class="form-group">
                            <label>Select Book: *</label>
                            <select id="borrowBookId" required>
                                <option value="">-- Select a book --</option>
                            </select>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Borrower Name: *</label>
                                <input type="text" id="borrowerName" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Borrower Email: *</label>
                                <input type="email" id="borrowerEmail" required>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Borrow Book</button>
                            <button type="button" class="btn btn-secondary" onclick="hideBorrowForm()">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Search and Filter Bar -->
                <div class="filter-bar">
                    <div class="filter-group">
                        <input type="text" id="searchBorrowerName" placeholder="üîç Search by borrower name..." 
                               onkeyup="debounceSearch('borrowRecords')">
                        <input type="text" id="searchBorrowerEmail" placeholder="‚úâÔ∏è Search by email..." 
                               onkeyup="debounceSearch('borrowRecords')">
                    </div>
                    <div class="filter-group">
                        <label>Status:</label>
                        <select id="statusFilter" onchange="loadBorrowRecords(1)">
                            <option value="">All</option>
                            <option value="borrowed">Borrowed</option>
                            <option value="returned">Returned</option>
                        </select>
                        <select id="sortByBorrowRecords" onchange="loadBorrowRecords(1)">
                            <option value="borrow_date">Sort by: Borrow Date</option>
                            <option value="return_date">Sort by: Return Date</option>
                            <option value="borrower_name">Sort by: Borrower Name</option>
                            <option value="status">Sort by: Status</option>
                        </select>
                        <select id="sortOrderBorrowRecords" onchange="loadBorrowRecords(1)">
                            <option value="desc">Descending</option>
                            <option value="asc">Ascending</option>
                        </select>
                        <button class="btn btn-secondary btn-sm" onclick="clearBorrowRecordsFilters()">
                            Clear Filters
                        </button>
                    </div>
                </div>

                <!-- Results Info -->
                <div id="borrowRecordsResultInfo" class="result-info"></div>

                <!-- Borrow Records List -->
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Book</th>
                                <th>Borrower</th>
                                <th>Email</th>
                                <th>Borrow Date</th>
                                <th>Return Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="borrowRecordsTableBody">
                            <!-- Records will be loaded here -->
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div id="borrowRecordsPagination" class="pagination"></div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Library Management System - REST API Client-Server Architecture</p>
        </div>
    </footer>

    <script src="app.js"></script>
</body>
</html>
